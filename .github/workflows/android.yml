# 工作流名称
name: Android APP 自动构建

# 触发条件：推送以 v 开头的 Tag 时触发
on:
  push:
    tags:
      - 'v*' # 匹配所有以 v 开头的标签，如 v1.0.0、v2.1.5-beta 等

# 工作流任务
jobs:
  build:
    # 运行环境：最新版 Ubuntu
    runs-on: ubuntu-latest

    steps:
      # 步骤1：拉取仓库代码
      - name: 检出代码
        uses: actions/checkout@v4

      # 步骤2：配置 JDK 环境（Android 构建需要 JDK 17）
      - name: 设置 JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'
          cache: gradle

      # 步骤3：授予 gradlew 可执行权限
      - name: 授予 Gradle 执行权限
        run: chmod +x ./gradlew

      # 步骤4：构建 Release 版本的 APK
      - name: 构建 Release APK
        run: ./gradlew assembleRelease --stacktrace

      # 步骤5：创建 GitHub Release 并上传 APK
      - name: 上传 APK 到 Releases
        uses: softprops/action-gh-release@v2
        with:
          # 上传构建好的 APK 文件（路径需根据你的项目调整，默认是 app/build/outputs/apk/release/）
          files: |
            app/build/outputs/apk/release/*.apk
          # 自动生成 Release 说明
          generate_release_notes: true
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }} # GitHub 自动提供的令牌，用于上传文件
